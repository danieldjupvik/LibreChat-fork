# Start with the official image
FROM ghcr.io/danny-avila/librechat-dev:latest

# Copy your entire codebase (overwriting theirs)
COPY --chown=node:node . .

# Only run the frontend build portion
USER node
RUN NODE_OPTIONS="--max-old-space-size=2048" npm run frontend && \
    npm cache clean --force

# Keep the rest of the image intact
EXPOSE 3080
ENV HOST=0.0.0.0
CMD ["npm", "run", "backend"]